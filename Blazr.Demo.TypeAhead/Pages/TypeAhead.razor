
<input class="form-control mb-3" type="search" value="@this.Value" @onchange=this.OnChange list="@listid" @oninput=this.OnSearchUpdated />

<datalist id="@listid">
    @foreach (var item in this.Items)
    {
            <option>@item</option>
    }
</datalist>

@code {
    [Parameter] public string? Value { get; set; }
    [Parameter] public EventCallback<string?> ValueChanged { get; set; }
    [Parameter, EditorRequired] public Func<string?, Task<IEnumerable<string>>>? FilterItems { get; set; }

    private InputThrottler inputThrottler;
    private string? filterText;
    private string listid = Guid.NewGuid().ToString();
    private IEnumerable<string> Items = Enumerable.Empty<string>();

    public TypeAhead()
        => inputThrottler = InputThrottler.Create(GetFilteredItems, 300);

    protected override Task OnInitializedAsync()
    {
        return GetFilteredItems();
    }

    private Task OnChange(ChangeEventArgs e)
    => this.ValueChanged.InvokeAsync(e.Value?.ToString());

    private async void OnSearchUpdated(ChangeEventArgs e)
    {
        this.filterText = e.Value?.ToString() ?? string.Empty;
        if (await inputThrottler.QueueAsync())
            StateHasChanged();
    }

    private async Task GetFilteredItems()
    {
        if (FilterItems is not null)
            this.Items = await FilterItems.Invoke(filterText);
    }

}
